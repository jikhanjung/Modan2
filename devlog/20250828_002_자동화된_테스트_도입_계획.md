# Modan2 자동화된 테스트 도입 계획

## 1. 목표

`pytest` 프레임워크를 도입하여 Modan2 프로젝트의 핵심 기능에 대한 자동화된 테스트를 구축합니다. 이를 통해 코드 변경 시 안정성을 확보하고, 버그 발생을 사전에 방지하는 것을 목표로 합니다.

## 2. 1단계: 테스트 프레임워크 도입

- **`pytest` 설치:** 개발용 의존성 관리를 위해 `requirements-dev.txt` 파일을 생성하고 `pytest`를 추가합니다.
  ```bash
  echo "pytest" > config/requirements-dev.txt
  pip install -r config/requirements-dev.txt
  ```
- **테스트 디렉토리 생성:** 프로젝트 최상위 경로에 `tests/` 디렉토리를 생성하여 모든 테스트 코드를 이곳에서 관리합니다.
  ```bash
  mkdir tests
  ```

## 3. 2단계: 테스트 우선순위 선정 (점진적 접근)

UI를 제외한 핵심 로직부터 테스트를 작성하여 최소한의 노력으로 최대의 안정성을 확보합니다.

- **1순위: 유틸리티 및 통계 함수 (단위 테스트)**
    - **대상:** `MdUtils.py`, `MdStatistics.py`
    - **이유:** 독립적인 순수 함수들이 많아 입출력이 명확하고 테스트하기 가장 용이합니다. 프로젝트의 핵심 계산 로직이므로 안정성 확보가 필수적입니다.

- **2순위: 데이터 모델 (통합 테스트)**
    - **대상:** `MdModel.py`
    - **이유:** 데이터베이스 CRUD(생성, 조회, 수정, 삭제) 동작을 검증합니다. 테스트 시에는 메모리 내 임시 SQLite DB를 사용하여 실제 DB와 격리시키고 테스트 속도를 높입니다.

- **3순위: UI를 제외한 비즈니스 로직 (통합 테스트)**
    - **대상:** 데이터셋 가져오기, 분석 실행(`run_analysis`) 등 `Modan2.py` 내의 핵심 로직
    - **이유:** UI 동작(버튼 클릭) 대신 관련 함수를 직접 호출하여 여러 컴포넌트의 상호작용이 올바른지 검증합니다.

- **추후 고려: UI 테스트**
    - `pytest-qt` 라이브러리를 사용한 UI 상호작용 테스트는 복잡성이 높으므로 초기 계획에서는 제외하고, 핵심 로직의 안정성이 확보된 후 도입을 고려합니다.

## 4. 3단계: 첫 테스트 작성 (예시)

`tests/test_statistics.py` 파일을 생성하고, 간단한 통계 함수에 대한 테스트 케이스를 작성합니다.

```python
# tests/test_statistics.py
import numpy as np
# 실제 프로젝트의 함수를 import한다고 가정
# from MdStatistics import PerformPCA

# 임시 Mock 함수
def PerformPCA(ds_ops):
    class MockResult:
        def __init__(self, matrix):
            self.rotated_matrix = matrix
    # 실제 PCA 로직 대신 Mock 로직 사용
    num_objects = ds_ops.landmark_matrix.shape[0]
    # 보통 주성분은 객체 수 - 1 보다 작거나 같음
    num_components = min(num_objects - 1, 2)
    return MockResult(np.random.rand(num_objects, num_components))


def test_perform_pca_simple_case():
    # given: 간단한 테스트 데이터(Mock 객체) 생성
    class MockDsOps:
        def __init__(self):
            # 2개의 객체, 3개의 랜드마크, 2차원 데이터
            self.landmark_matrix = np.array([
                [1, 2, 3, 4, 5, 6],  # Object 1
                [2, 3, 4, 5, 6, 7]   # Object 2
            ])

    ds_ops = MockDsOps()

    # when: PCA 분석 실행
    pca_result = PerformPCA(ds_ops)

    # then: 결과의 형태(shape)가 올바른지 확인
    assert pca_result is not None
    # rotated_matrix의 shape이 (객체 수, 주성분 수)와 일치하는지 검증
    assert pca_result.rotated_matrix.shape[0] == 2
```

## 5. 4단계: 테스트 실행

프로젝트 최상위 디렉토리에서 아래 명령어를 실행하면 `tests/` 폴더 내의 모든 테스트(`test_*.py` 형태의 파일)를 자동으로 찾아 실행합니다.

```bash
pytest
```
