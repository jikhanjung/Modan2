# Modan2 테스트 실행 방법 가이드

## 작성일: 2025-08-28

## 1. 개요

Modan2 프로젝트에 구축된 자동화 테스트 시스템의 실행 방법과 활용법을 안내합니다. pytest 기반의 58개 테스트가 프로젝트의 핵심 기능을 검증합니다.

## 2. 테스트 환경 설정

### 2.1 필수 패키지 설치

```bash
# 개발 의존성 설치 (테스트 도구들)
pip install -r config/requirements-dev.txt

# 주요 패키지들
# - pytest==8.3.3           # 핵심 테스트 프레임워크
# - pytest-cov==5.0.0       # 코드 커버리지 측정
# - pytest-mock==3.14.0     # Mock 기능
# - pytest-qt==4.4.0        # PyQt5 UI 테스트
# - pytest-xvfb==3.0.0      # Headless GUI 테스트
```

### 2.2 Linux/WSL 시스템 의존성 (필요한 경우)

```bash
sudo apt-get install -y \
  libxcb-xinerama0 libxcb-icccm4 libxcb-image0 libxcb-keysyms1 \
  libxcb-randr0 libxcb-render-util0 libxcb-xfixes0 libxcb-shape0 \
  libxcb-cursor0 qt5-qmake qtbase5-dev libqt5gui5 libqt5core5a \
  libqt5widgets5 libglut-dev libglut3.12 python3-opengl
```

## 3. 기본 테스트 실행 명령어

### 3.1 전체 테스트 실행

```bash
# 모든 테스트 실행 (58개 테스트)
pytest tests/

# 간결한 출력으로 실행
pytest tests/ -q

# 상세한 출력으로 실행
pytest tests/ -v
```

### 3.2 특정 테스트 파일 실행

```bash
# MdUtils 테스트만 실행 (24개 테스트)
pytest tests/test_mdutils.py

# MdModel 테스트만 실행 (18개 테스트)  
pytest tests/test_mdmodel.py

# MdStatistics 테스트만 실행 (16개 테스트)
pytest tests/test_mdstatistics.py
```

### 3.3 특정 테스트 클래스 또는 함수 실행

```bash
# 특정 클래스의 테스트만 실행
pytest tests/test_mdutils.py::TestConstants

# 특정 테스트 함수만 실행
pytest tests/test_mdutils.py::TestConstants::test_program_constants

# 패턴으로 테스트 선택
pytest -k "test_pca" tests/
```

## 4. 코드 커버리지 측정

### 4.1 기본 커버리지 측정

```bash
# 커버리지와 함께 테스트 실행
pytest tests/ --cov=.

# 터미널에서 커버리지 보고서 출력
pytest tests/ --cov=. --cov-report=term

# 누락된 라인 표시
pytest tests/ --cov=. --cov-report=term-missing
```

### 4.2 HTML 커버리지 보고서 생성

```bash
# HTML 보고서 생성
pytest tests/ --cov=. --cov-report=html

# 보고서 확인 (브라우저에서 열림)
# Linux
xdg-open htmlcov/index.html

# macOS  
open htmlcov/index.html

# Windows
start htmlcov/index.html
```

### 4.3 특정 모듈 커버리지 측정

```bash
# MdUtils.py만 커버리지 측정
pytest tests/test_mdutils.py --cov=MdUtils --cov-report=term

# 여러 모듈 지정
pytest tests/ --cov=MdUtils --cov=MdModel --cov=MdStatistics --cov-report=term
```

## 5. 고급 테스트 실행 옵션

### 5.1 실행 제어 옵션

```bash
# 첫 번째 실패에서 중단
pytest tests/ -x

# 최대 3개 실패까지만 허용
pytest tests/ --maxfail=3

# 실패한 테스트만 재실행
pytest tests/ --lf

# 마지막 실패 및 관련 테스트 실행
pytest tests/ --ff
```

### 5.2 출력 제어 옵션

```bash
# 간단한 출력 (성공 시 .만 표시)
pytest tests/ -q

# 상세한 출력 (각 테스트 이름 표시)
pytest tests/ -v

# 매우 상세한 출력 (더 많은 디버그 정보)
pytest tests/ -vv

# 짧은 traceback
pytest tests/ --tb=short

# traceback 없이
pytest tests/ --tb=no
```

### 5.3 병렬 실행 (pytest-xdist 설치 필요)

```bash
# pytest-xdist 설치
pip install pytest-xdist

# 자동으로 CPU 코어 수만큼 병렬 실행
pytest tests/ -n auto

# 특정 수의 프로세스로 병렬 실행
pytest tests/ -n 4
```

## 6. 테스트 결과 이해하기

### 6.1 성공적인 테스트 실행 결과

```
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-8.3.3, pluggy-1.6.0
collecting ... collected 58 items

tests/test_mdmodel.py ..................                                 [ 31%]
tests/test_mdstatistics.py ................                              [ 58%]
tests/test_mdutils.py ........................                           [100%]

============================== 58 passed in 3.59s ==============================
```

### 6.2 커버리지 보고서 해석

```
Name                         Stmts   Miss  Cover
------------------------------------------------
MdLogger.py                     15      0   100%
MdUtils.py                     100     10    90%
MdStatistics.py                262     41    84%
MdModel.py                    1126    898    20%
tests/test_mdutils.py          183      0   100%
------------------------------------------------
TOTAL                        11259  10185    10%
```

- **Stmts**: 총 실행 가능한 코드 라인 수
- **Miss**: 테스트되지 않은 라인 수  
- **Cover**: 커버리지 백분율 (100% - (Miss/Stmts)*100)

### 6.3 실패 시 디버깅

```bash
# 실패한 테스트 상세 정보 출력
pytest tests/ -v --tb=long

# 표준 출력 캡처 비활성화 (print 문 확인)
pytest tests/ -s

# 로그 출력 활성화
pytest tests/ --log-cli-level=INFO
```

## 7. 개발 워크플로우에서의 테스트 활용

### 7.1 개발 중 테스트

```bash
# 1. 코드 수정 후 관련 테스트만 빠르게 실행
pytest tests/test_mdutils.py -v

# 2. 전체 테스트로 회귀 테스트
pytest tests/ -x

# 3. 커버리지 확인
pytest tests/ --cov=MdUtils --cov-report=term
```

### 7.2 커밋 전 체크리스트

```bash
# 1. 전체 테스트 실행
pytest tests/

# 2. 커버리지 확인 (목표: 주요 모듈 80% 이상)
pytest tests/ --cov=. --cov-report=term

# 3. 애플리케이션 실행 테스트
python Modan2.py  # 또는 python fix_qt_import.py (Linux)
```

### 7.3 새 기능 개발 시 TDD 워크플로우

```bash
# 1. 실패하는 테스트 작성
pytest tests/test_new_feature.py -v  # 실패 확인

# 2. 최소 구현으로 테스트 통과시키기
pytest tests/test_new_feature.py -v  # 성공 확인

# 3. 리팩토링 후 전체 테스트
pytest tests/ -x
```

## 8. CI/CD에서의 테스트 실행

### 8.1 GitHub Actions에서 자동 실행

프로젝트의 GitHub Actions는 다음 명령을 실행합니다:

```yaml
# .github/workflows/test.yml에서 실행되는 명령들
pytest tests/ \
  --cov=. \
  --cov-report=xml \
  --cov-report=term \
  --tb=short \
  -v
```

### 8.2 로컬에서 CI 환경 시뮬레이션

```bash
# CI와 동일한 환경 변수 설정
export QT_QPA_PLATFORM=offscreen
export DISPLAY=:99.0

# CI와 동일한 테스트 실행
pytest tests/ --cov=. --cov-report=xml --cov-report=term --tb=short -v
```

## 9. 성능 및 최적화

### 9.1 테스트 실행 시간 모니터링

```bash
# 가장 느린 테스트 10개 표시
pytest tests/ --durations=10

# 모든 테스트 실행 시간 표시  
pytest tests/ --durations=0

# 특정 시간보다 느린 테스트만 표시 (예: 1초 이상)
pytest tests/ --durations-min=1
```

### 9.2 테스트 최적화 팁

```bash
# 빠른 피드백을 위해 자주 변경되는 모듈만 먼저 테스트
pytest tests/test_mdutils.py -x

# 병렬 실행으로 전체 시간 단축
pytest tests/ -n auto

# 특정 마커만 실행 (예: 빠른 테스트만)
pytest tests/ -m "not slow"
```

## 10. 문제 해결

### 10.1 자주 발생하는 문제들

#### Qt 관련 오류
```bash
# 해결법 1: 환경 변수 설정
export QT_QPA_PLATFORM=offscreen
pytest tests/

# 해결법 2: xvfb 사용 (Linux)
sudo apt-get install xvfb
xvfb-run -a pytest tests/
```

#### Import 오류
```bash
# Python 경로 확인
python -c "import sys; print(sys.path)"

# 프로젝트 루트에서 실행 확인
pwd  # /home/user/projects/Modan2 이어야 함
pytest tests/
```

#### 의존성 오류
```bash
# 가상환경 활성화 확인
which python  # venv 경로여야 함

# 의존성 재설치
pip install -r requirements.txt -r config/requirements-dev.txt
```

### 10.2 디버깅 테크닉

```bash
# 테스트 내에서 pdb 디버거 사용
pytest tests/ -s --pdb

# 실패 시 자동으로 pdb 진입
pytest tests/ --pdb-trace

# 특정 테스트만 디버깅
pytest tests/test_mdutils.py::TestConstants::test_program_constants -s --pdb
```

## 11. 테스트 작성 가이드라인

### 11.1 새 테스트 작성 시

```bash
# 1. 테스트 파일 생성 (test_*.py 형식)
touch tests/test_new_module.py

# 2. 테스트 작성 후 검증
pytest tests/test_new_module.py -v

# 3. 전체 테스트와의 호환성 확인
pytest tests/ -x
```

### 11.2 테스트 품질 검증

```bash
# 테스트 커버리지 확인
pytest tests/test_new_module.py --cov=new_module --cov-report=term-missing

# 테스트만의 커버리지 확인 (테스트 파일 자체 품질)
pytest tests/ --cov=tests --cov-report=term
```

## 12. 모니터링 및 유지보수

### 12.1 정기적인 테스트 상태 점검

```bash
# 주간 체크: 전체 테스트 실행 시간 모니터링
pytest tests/ --durations=10

# 월간 체크: 커버리지 트렌드 확인  
pytest tests/ --cov=. --cov-report=html
# htmlcov/index.html에서 트렌드 분석

# 분기 체크: 테스트 품질 평가
pytest tests/ --cov=tests --cov-report=term
```

### 12.2 성능 기준

- **전체 테스트 실행 시간**: 10초 이내 (목표)
- **단위 테스트**: 100ms 이내
- **통합 테스트**: 1초 이내
- **커버리지 목표**: 
  - 핵심 모듈 (MdUtils): 90% 이상 ✅
  - 통계 모듈 (MdStatistics): 80% 이상 ✅
  - 데이터 모델 (MdModel): 50% 이상 ✅

## 13. 추가 도구 및 플러그인

### 13.1 유용한 pytest 플러그인

```bash
# 추가 플러그인 설치 (선택사항)
pip install pytest-html          # HTML 보고서
pip install pytest-json-report   # JSON 보고서  
pip install pytest-benchmark     # 성능 벤치마크
pip install pytest-timeout       # 테스트 타임아웃
```

### 13.2 IDE 통합

대부분의 Python IDE들이 pytest를 지원합니다:

- **VS Code**: Python 확장과 함께 자동 테스트 발견
- **PyCharm**: 내장 pytest 지원
- **vim/neovim**: vim-test 플러그인

## 14. 결론

이 가이드를 통해 Modan2 프로젝트의 테스트를 효율적으로 실행하고 관리할 수 있습니다. 

### 핵심 명령어 요약

```bash
# 일상적인 개발
pytest tests/ -x                    # 빠른 전체 테스트
pytest tests/test_mdutils.py        # 특정 모듈 테스트
pytest tests/ --cov=. --cov-report=term  # 커버리지 확인

# 문제 해결  
pytest tests/ -v --tb=long          # 상세한 오류 정보
pytest tests/ -s                    # print 출력 확인

# 성능 최적화
pytest tests/ -n auto               # 병렬 실행
pytest tests/ --durations=10        # 성능 모니터링
```

정기적인 테스트 실행을 통해 코드 품질을 유지하고, 버그를 조기에 발견하여 안정적인 소프트웨어를 개발할 수 있습니다.