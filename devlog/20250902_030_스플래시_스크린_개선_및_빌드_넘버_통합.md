# 스플래시 스크린 개선 및 빌드 넘버 통합

**작업 일시**: 2025-09-02  
**작업자**: Claude Code Assistant  
**작업 분류**: UI 개선, 빌드 시스템 향상  

## 📋 작업 개요

스플래시 스크린의 중복 메시지 표시 문제를 해결하고, GitHub Actions의 빌드 넘버를 프로그램에 통합하여 각 빌드를 고유하게 식별할 수 있도록 개선했습니다.

## 🔧 주요 변경사항

### 1. 스플래시 스크린 개선

#### 1.1 중복 진행상황 메시지 제거
- **파일**: `MdSplashScreen.py`
- **문제**: 진행상황 메시지가 두 곳에 중복 표시 (큰 메시지 + 작은 메시지)
- **해결**: `drawContents()` 메서드에서 작은 메시지 표시 코드 제거 (114-125줄)
- **결과**: `setProgress()` 메서드를 통한 큰 메시지만 표시되어 UI 깔끔함

#### 1.2 버전 및 카피라이트 정보 중앙화
- **변경 전**: 하드코딩된 버전 정보 ("v0.1.4", "© 2024 Modan2 Team")
- **변경 후**: `MdUtils` 모듈에서 중앙 관리되는 정보 사용
  ```python
  # MdSplashScreen.py
  import MdUtils as mu
  self.version = f"v{mu.PROGRAM_VERSION}"
  self.copyright = mu.PROGRAM_COPYRIGHT
  ```

### 2. 카피라이트 정보 동적 관리

#### 2.1 MdUtils.py 카피라이트 상수 추가
```python
# Dynamic copyright with current year
import datetime
CURRENT_YEAR = datetime.datetime.now().year
PROGRAM_COPYRIGHT = f"© 2023-{CURRENT_YEAR} Jikhan Jung"
```

#### 2.2 About 다이얼로그 업데이트
- **파일**: `Modan2.py:607-616`
- **변경**: 하드코딩된 카피라이트를 `mu.PROGRAM_COPYRIGHT` 사용
- **제거**: 로컬 datetime import 및 중복 연도 계산 로직

#### 2.3 스플래시 스크린 연동
- 스플래시 스크린도 동일한 `mu.PROGRAM_COPYRIGHT` 사용
- 모든 UI에서 일관된 카피라이트 정보 표시

### 3. GitHub Actions 빌드 넘버 통합 시스템

#### 3.1 빌드 정보 생성 (`build.py`)
**추가된 기능**:
```python
# Create build info file for runtime access
build_info = {
    "version": VERSION,
    "build_number": BUILD_NUMBER,  # GitHub Actions의 $GITHUB_RUN_NUMBER
    "build_date": DATE,
    "platform": platform.system().lower()
}

# Write build info to JSON file
import json
with open("build_info.json", "w") as f:
    json.dump(build_info, f, indent=2)
```

**PyInstaller 통합**:
- onefile 빌드에 `--add-data=build_info.json{separator}.` 추가
- onedir 빌드에도 동일하게 적용
- 빌드된 실행파일에 빌드 정보 포함

#### 3.2 런타임 빌드 정보 읽기 (`MdUtils.py`)
**새 함수 추가**:
```python
def get_build_info():
    """Get build information from build_info.json file."""
    # 다양한 경로에서 build_info.json 찾기
    search_paths = [
        Path("build_info.json"),  # 개발환경
        Path(sys.executable).parent / "build_info.json",  # PyInstaller onedir
        Path(sys._MEIPASS) / "build_info.json",  # PyInstaller onefile
    ]
    # Fallback 처리 포함
```

**새 상수 추가**:
```python
BUILD_INFO = get_build_info()
PROGRAM_BUILD_NUMBER = BUILD_INFO.get("build_number", "local")
PROGRAM_BUILD_DATE = BUILD_INFO.get("build_date", "unknown")
```

#### 3.3 UI에 빌드 넘버 표시

**About 다이얼로그** (`Modan2.py`):
```python
# Show version with build number
version_text = f"v{mu.PROGRAM_VERSION} (Build {mu.PROGRAM_BUILD_NUMBER})"

text = mu.PROGRAM_NAME + " " + version_text + "\n\n"
```

**스플래시 스크린** (`MdSplashScreen.py`):
```python
# Version and copyright info from MdUtils (consistent with main app)
version_text = f"v{mu.PROGRAM_VERSION} (Build {mu.PROGRAM_BUILD_NUMBER})"
self.version = version_text
```

#### 3.4 GitHub Actions 워크플로우 확인
- **확인된 설정**: `.github/workflows/build.yml`에서 이미 `BUILD_NUMBER: ${{ github.run_number }}` 전달 중
- **플랫폼별 빌드**: Windows (line 36), macOS (line 95), Linux (line 157)
- **빌드 아티팩트**: 자동으로 증분되는 고유 빌드 넘버 포함

### 4. 프로젝트 관리 개선

#### 4.1 .gitignore 업데이트
```gitignore
# Build info file (generated during build)
build_info.json
```
- 빌드 시 생성되는 `build_info.json` 파일을 git 추적에서 제외

## 🎯 작업 결과

### UI 개선
- ✅ 스플래시 스크린 중복 메시지 제거
- ✅ 모든 UI에서 일관된 버전/카피라이트 표시
- ✅ 동적 연도 업데이트 (2023-2025 형식)

### 빌드 시스템 향상
- ✅ GitHub Actions 빌드 넘버 자동 통합
- ✅ 개발환경과 배포환경 구분 ("local" vs 실제 빌드넘버)
- ✅ 크로스플랫폼 빌드 정보 지원

### 버전 표시 개선
- **개발환경**: "Modan2 v0.1.4 (Build local)"
- **GitHub Actions 빌드**: "Modan2 v0.1.4 (Build 123)"
- **스플래시/About 일관성**: 항상 빌드 넘버 표시, 동일한 형식

## 🔍 기술적 세부사항

### 빌드 정보 탐지 로직
1. **개발환경**: 프로젝트 루트의 `build_info.json`
2. **PyInstaller onedir**: 실행파일 디렉토리의 `build_info.json`
3. **PyInstaller onefile**: `sys._MEIPASS` 내의 `build_info.json`
4. **Fallback**: 기본값 (version, "local", "unknown", "unknown")

### 중앙화된 상수 관리
- `MdUtils.py`가 모든 프로그램 정보의 Single Source of Truth
- `PROGRAM_VERSION`, `PROGRAM_COPYRIGHT`, `PROGRAM_BUILD_NUMBER` 통합 관리
- 변경사항이 모든 UI에 자동 반영

## 📈 향후 개선 계획

1. **빌드 정보 확장**: Git commit hash, branch 정보 추가 고려
2. **로깅 개선**: 빌드 정보를 로그에 포함하여 디버깅 지원
3. **설정 UI**: 고급 사용자를 위한 빌드 정보 표시 옵션

## 🔗 관련 파일

### 수정된 파일
- `MdSplashScreen.py` - 중복 메시지 제거, 빌드 넘버 표시
- `MdUtils.py` - 카피라이트 상수, 빌드 정보 읽기 함수 추가
- `Modan2.py` - About 다이얼로그 빌드 넘버 표시
- `build.py` - 빌드 정보 JSON 생성, PyInstaller 통합
- `.gitignore` - build_info.json 제외

### 확인한 파일
- `.github/workflows/build.yml` - GitHub Actions 빌드 넘버 전달 확인
- `version_utils.py` - 기존 버전 관리 유틸리티 검토

## 📊 테스트 방법

1. **개발환경 테스트**:
   ```bash
   python Modan2.py
   # About 다이얼로그: "Modan2 v0.1.4 (Build local)"
   ```

2. **빌드 테스트**:
   ```bash
   BUILD_NUMBER=123 python build.py
   # 생성된 실행파일에서 "Modan2 v0.1.4 (Build 123)" 표시 확인
   ```

3. **GitHub Actions 테스트**:
   - 다음 push/tag 시 자동 빌드에서 실제 빌드 넘버 확인

---

이번 작업으로 Modan2의 버전 관리 시스템이 한층 더 체계적이고 사용자 친화적으로 개선되었습니다.