# Modan2.py 리팩토링 계획

## 작성일: 2025-08-29

## 1. 목표

`Modan2.py` 파일에 집중된 UI, 이벤트 처리, 데이터베이스 관리, 핵심 로직을 **역할과 책임에 따라 분리**하여 프로젝트의 유지보수성, 안정성, 확장성을 향상시키는 것을 목표로 한다.

모든 과정은 기존에 구축된 자동화 테스트 스위트를 통해 안정성을 검증하며 점진적으로 진행한다.

---

## 2. 리팩토링 계획 (4단계)

### **1단계: 컨트롤러(Controller) 분리 - 핵심 로직 추출 (가장 중요)**

사용자의 액션(버튼 클릭, 메뉴 선택 등)을 처리하는 "로직"을 별도의 `ModanController.py` 파일로 분리한다.

1.  **`ModanController.py` 파일 생성**:
    *   `ModanMainWindow`를 제어하는 `ModanController` 클래스를 정의한다. 이 클래스는 `ModanMainWindow`의 인스턴스를 참조하여 필요 시 UI를 업데이트하거나 상태를 가져온다.

2.  **이벤트 핸들러 로직 이전 (점진적)**:
    *   `Modan2.py`의 `on_action_...` 같은 이벤트 처리 함수의 내용을 `ModanController`의 새 메소드로 옮긴다.
    *   `Modan2.py`에 남아있는 원래 메소드는 컨트롤러의 새 메소드를 호출하는 역할만 하도록 수정한다.
    *   **검증**: 메소드 하나를 옮길 때마다, 앱 실행과 `pytest`를 통해 기능이 정상 동작하는지 확인한다.
    *   **주요 이전 대상**: `run_analysis`, `load_dataset`, `dropEvent` 등 모든 `on_...` 메소드 및 관련 로직.

### **2단계: 애플리케이션 진입점(Entry Point) 분리**

프로그램 시작과 관련된 코드를 분리하여 역할을 명확하게 한다.

1.  **`main.py` 파일 생성**:
    *   `Modan2.py`의 `if __name__ == "__main__":` 블록 전체를 `main.py`로 옮겨 프로그램의 공식 진입점으로 삼는다.

2.  **`MdAppSetup.py` 파일 생성 (가칭)**:
    *   데이터베이스 준비(`prepare_database`), 설정 로딩(`read_settings`) 등 앱 시작에 필요한 준비 코드를 이 파일로 옮긴다. `main.py`는 이 파일의 함수를 호출하여 앱을 준비시킨다.

### **3단계: 뷰(View) 코드 정리**

`ModanMainWindow` 클래스 내부의 복잡한 UI 생성 코드를 정리하여 가독성을 높인다.

1.  **`initUI` 메소드 분해**:
    *   `initUI` 내부의 코드를 `_create_toolbar()`, `_create_menus()`, `_create_layouts()` 와 같은 여러 개의 내부(private) 메소드로 나눈다.
    *   이를 통해 `__init__` 메소드가 더 간결해지고 UI 구조를 한눈에 파악하기 쉬워진다.

### **4단계: 상수 및 유틸리티 분리**

전역으로 사용되는 데이터나 작은 도우미 함수들을 분리한다.

1.  **`MdConstants.py` 파일 생성 (가칭)**:
    *   `Modan2.py` 상단에 있는 `ICON` 딕셔너리를 이 파일로 옮긴다.
    *   프로젝트 전반에서 사용될 다른 상수들도 이곳에서 통합 관리한다.

---

## 3. 기대 효과

-   **유지보수성 향상**: 각 파일의 역할이 명확해져 코드 이해 및 수정이 용이해진다.
-   **안정성 증가**: 복잡도 감소로 인해 예기치 않은 버그 발생 가능성이 줄어든다.
-   **확장성 개선**: 새로운 기능을 추가할 때 수정해야 할 파일과 범위가 명확해진다.
-   **팀 협업 효율 증대**: 역할 분담이 용이해지고 코드 충돌 가능성이 감소한다.
